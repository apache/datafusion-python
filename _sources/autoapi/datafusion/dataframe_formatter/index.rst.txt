datafusion.dataframe_formatter
==============================

.. py:module:: datafusion.dataframe_formatter

.. autoapi-nested-parse::

   HTML formatting utilities for DataFusion DataFrames.



Classes
-------

.. autoapisummary::

   datafusion.dataframe_formatter.CellFormatter
   datafusion.dataframe_formatter.DataFrameHtmlFormatter
   datafusion.dataframe_formatter.DefaultStyleProvider
   datafusion.dataframe_formatter.FormatterManager
   datafusion.dataframe_formatter.StyleProvider


Functions
---------

.. autoapisummary::

   datafusion.dataframe_formatter._refresh_formatter_reference
   datafusion.dataframe_formatter._validate_bool
   datafusion.dataframe_formatter._validate_formatter_parameters
   datafusion.dataframe_formatter._validate_positive_int
   datafusion.dataframe_formatter.configure_formatter
   datafusion.dataframe_formatter.get_formatter
   datafusion.dataframe_formatter.reset_formatter
   datafusion.dataframe_formatter.set_formatter


Module Contents
---------------

.. py:class:: CellFormatter

   Bases: :py:obj:`Protocol`


   Protocol for cell value formatters.


   .. py:method:: __call__(value: Any) -> str

      Format a cell value to string representation.



.. py:class:: DataFrameHtmlFormatter(max_cell_length: int = 25, max_width: int = 1000, max_height: int = 300, max_memory_bytes: int = 2 * 1024 * 1024, min_rows: int = 10, max_rows: int | None = None, repr_rows: int | None = None, enable_cell_expansion: bool = True, custom_css: str | None = None, show_truncation_message: bool = True, style_provider: StyleProvider | None = None, use_shared_styles: bool = True)

   Configurable HTML formatter for DataFusion DataFrames.

   This class handles the HTML rendering of DataFrames for display in
   Jupyter notebooks and other rich display contexts.

   This class supports extension through composition. Key extension points:
   - Provide a custom StyleProvider for styling cells and headers
   - Register custom formatters for specific types
   - Provide custom cell builders for specialized cell rendering

   :param max_cell_length: Maximum characters to display in a cell before truncation
   :param max_width: Maximum width of the HTML table in pixels
   :param max_height: Maximum height of the HTML table in pixels
   :param max_memory_bytes: Maximum memory in bytes for rendered data (default: 2MB)
   :param min_rows: Minimum number of rows to display (must be <= max_rows)
   :param max_rows: Maximum number of rows to display in repr output
   :param repr_rows: Deprecated alias for max_rows
   :param enable_cell_expansion: Whether to add expand/collapse buttons for long cell
                                 values
   :param custom_css: Additional CSS to include in the HTML output
   :param show_truncation_message: Whether to display a message when data is truncated
   :param style_provider: Custom provider for cell and header styles
   :param use_shared_styles: Whether to load styles and scripts only once per notebook
                             session

   Initialize the HTML formatter.

   :param max_cell_length: Maximum length of cell content before truncation.
   :param max_width: Maximum width of the displayed table in pixels.
   :param max_height: Maximum height of the displayed table in pixels.
   :param max_memory_bytes: Maximum memory in bytes for rendered data. Helps prevent performance
                            issues with large datasets.
   :param min_rows: Minimum number of rows to display even if memory limit is reached.
                    Must not exceed ``max_rows``.
   :param max_rows: Maximum number of rows to display. Takes precedence over memory limits
                    when fewer rows are requested.
   :param repr_rows: Deprecated alias for ``max_rows``. Use ``max_rows`` instead.
   :param enable_cell_expansion: Whether to allow cells to expand when clicked.
   :param custom_css: Custom CSS to apply to the HTML table.
   :param show_truncation_message: Whether to show a message indicating that content has been truncated.
   :param style_provider: Provider of CSS styles for the HTML table. If None, DefaultStyleProvider
                          is used.
   :param use_shared_styles: Whether to use shared styles across multiple tables. This improves
                             performance when displaying many DataFrames in a single notebook.
   :param Raises:
   :param ------:
   :param ValueError: If max_cell_length, max_width, max_height, max_memory_bytes,
                      min_rows or max_rows is not a positive integer, or if min_rows
                      exceeds max_rows.
   :param TypeError: If enable_cell_expansion, show_truncation_message, or use_shared_styles is
                     not a boolean, or if custom_css is provided but is not a string, or if
                     style_provider is provided but does not implement the StyleProvider
                     protocol.


   .. py:method:: _build_expandable_cell(formatted_value: str, row_count: int, col_idx: int, table_uuid: str) -> str

      Build an expandable cell for long content.



   .. py:method:: _build_html_footer(has_more: bool) -> list[str]

      Build the HTML footer with JavaScript and messages.



   .. py:method:: _build_html_header() -> list[str]

      Build the HTML header with CSS styles.



   .. py:method:: _build_regular_cell(formatted_value: str) -> str

      Build a regular table cell.



   .. py:method:: _build_table_body(batches: list, table_uuid: str) -> list[str]

      Build the HTML table body with data rows.



   .. py:method:: _build_table_container_start() -> list[str]

      Build the opening tags for the table container.



   .. py:method:: _build_table_header(schema: Any) -> list[str]

      Build the HTML table header with column names.



   .. py:method:: _format_cell_value(value: Any) -> str

      Format a cell value for display.

      Uses registered type formatters if available.

      :param value: The cell value to format

      :returns: Formatted cell value as string



   .. py:method:: _get_cell_value(column: Any, row_idx: int) -> Any

      Extract a cell value from a column.

      :param column: Arrow array
      :param row_idx: Row index

      :returns: The raw cell value



   .. py:method:: _get_default_css() -> str

      Get default CSS styles for the HTML table.



   .. py:method:: _get_javascript() -> str

      Get JavaScript code for interactive elements.



   .. py:method:: format_html(batches: list, schema: Any, has_more: bool = False, table_uuid: str | None = None) -> str

      Format record batches as HTML.

      This method is used by DataFrame's _repr_html_ implementation and can be
      called directly when custom HTML rendering is needed.

      :param batches: List of Arrow RecordBatch objects
      :param schema: Arrow Schema object
      :param has_more: Whether there are more batches not shown
      :param table_uuid: Unique ID for the table, used for JavaScript interactions

      :returns: HTML string representation of the data

      :raises TypeError: If schema is invalid and no batches are provided



   .. py:method:: format_str(batches: list, schema: Any, has_more: bool = False, table_uuid: str | None = None) -> str

      Format record batches as a string.

      This method is used by DataFrame's __repr__ implementation and can be
      called directly when string rendering is needed.

      :param batches: List of Arrow RecordBatch objects
      :param schema: Arrow Schema object
      :param has_more: Whether there are more batches not shown
      :param table_uuid: Unique ID for the table, used for JavaScript interactions

      :returns: String representation of the data

      :raises TypeError: If schema is invalid and no batches are provided



   .. py:method:: register_formatter(type_class: type, formatter: CellFormatter) -> None

      Register a custom formatter for a specific data type.

      :param type_class: The type to register a formatter for
      :param formatter: Function that takes a value of the given type and returns
                        a formatted string



   .. py:method:: set_custom_cell_builder(builder: collections.abc.Callable[[Any, int, int, str], str]) -> None

      Set a custom cell builder function.

      :param builder: Function that takes (value, row, col, table_id) and returns HTML



   .. py:method:: set_custom_header_builder(builder: collections.abc.Callable[[Any], str]) -> None

      Set a custom header builder function.

      :param builder: Function that takes a field and returns HTML



   .. py:attribute:: _custom_cell_builder
      :type:  collections.abc.Callable[[Any, int, int, str], str] | None
      :value: None



   .. py:attribute:: _custom_header_builder
      :type:  collections.abc.Callable[[Any], str] | None
      :value: None



   .. py:attribute:: _max_rows
      :value: None



   .. py:attribute:: _type_formatters
      :type:  dict[type, CellFormatter]


   .. py:attribute:: custom_css
      :value: None



   .. py:attribute:: enable_cell_expansion
      :value: True



   .. py:attribute:: max_cell_length
      :value: 25



   .. py:attribute:: max_height
      :value: 300



   .. py:attribute:: max_memory_bytes
      :value: 2097152



   .. py:property:: max_rows
      :type: int


      Get the maximum number of rows to display.

      :returns: The maximum number of rows to display in repr output


   .. py:attribute:: max_width
      :value: 1000



   .. py:attribute:: min_rows
      :value: 10



   .. py:property:: repr_rows
      :type: int


      Get the maximum number of rows (deprecated name).

      .. deprecated::
          Use :attr:`max_rows` instead. This property is provided for
          backward compatibility.

      :returns: The maximum number of rows to display


   .. py:attribute:: show_truncation_message
      :value: True



   .. py:attribute:: style_provider


   .. py:attribute:: use_shared_styles
      :value: True



.. py:class:: DefaultStyleProvider

   Default implementation of StyleProvider.


   .. py:method:: get_cell_style() -> str

      Get the CSS style for table cells.

      :returns: CSS style string



   .. py:method:: get_header_style() -> str

      Get the CSS style for header cells.

      :returns: CSS style string



.. py:class:: FormatterManager

   Manager class for the global DataFrame HTML formatter instance.


   .. py:method:: get_formatter() -> DataFrameHtmlFormatter
      :classmethod:


      Get the current global DataFrame HTML formatter.

      :returns: The global HTML formatter instance



   .. py:method:: set_formatter(formatter: DataFrameHtmlFormatter) -> None
      :classmethod:


      Set the global DataFrame HTML formatter.

      :param formatter: The formatter instance to use globally



   .. py:attribute:: _default_formatter
      :type:  DataFrameHtmlFormatter


.. py:class:: StyleProvider

   Bases: :py:obj:`Protocol`


   Protocol for HTML style providers.


   .. py:method:: get_cell_style() -> str

      Get the CSS style for table cells.



   .. py:method:: get_header_style() -> str

      Get the CSS style for header cells.



.. py:function:: _refresh_formatter_reference() -> None

   Refresh formatter reference in any modules using it.

   This helps ensure that changes to the formatter are reflected in existing
   DataFrames that might be caching the formatter reference.


.. py:function:: _validate_bool(value: Any, param_name: str) -> None

   Validate that a parameter is a boolean.

   :param value: The value to validate
   :param param_name: Name of the parameter (used in error message)

   :raises TypeError: If the value is not a boolean


.. py:function:: _validate_formatter_parameters(max_cell_length: int, max_width: int, max_height: int, max_memory_bytes: int, min_rows: int, max_rows: int | None, repr_rows: int | None, enable_cell_expansion: bool, show_truncation_message: bool, use_shared_styles: bool, custom_css: str | None, style_provider: Any) -> int

   Validate all formatter parameters and return resolved max_rows value.

   :param max_cell_length: Maximum cell length value to validate
   :param max_width: Maximum width value to validate
   :param max_height: Maximum height value to validate
   :param max_memory_bytes: Maximum memory bytes value to validate
   :param min_rows: Minimum rows to display value to validate
   :param max_rows: Maximum rows value to validate (None means use default)
   :param repr_rows: Deprecated repr_rows value to validate
   :param enable_cell_expansion: Boolean expansion flag to validate
   :param show_truncation_message: Boolean message flag to validate
   :param use_shared_styles: Boolean styles flag to validate
   :param custom_css: Custom CSS string to validate
   :param style_provider: Style provider object to validate

   :returns: The resolved max_rows value after handling repr_rows deprecation

   :raises ValueError: If any numeric parameter is invalid or constraints are violated
   :raises TypeError: If any parameter has invalid type
   :raises DeprecationWarning: If repr_rows parameter is used


.. py:function:: _validate_positive_int(value: Any, param_name: str) -> None

   Validate that a parameter is a positive integer.

   :param value: The value to validate
   :param param_name: Name of the parameter (used in error message)

   :raises ValueError: If the value is not a positive integer


.. py:function:: configure_formatter(**kwargs: Any) -> None

   Configure the global DataFrame HTML formatter.

   This function creates a new formatter with the provided configuration
   and sets it as the global formatter for all DataFrames.

   :param \*\*kwargs: Formatter configuration parameters like max_cell_length,
                      max_width, max_height, enable_cell_expansion, etc.

   :raises ValueError: If any invalid parameters are provided

   .. rubric:: Example

   >>> from datafusion.html_formatter import configure_formatter
   >>> configure_formatter(
   ...     max_cell_length=50,
   ...     max_height=500,
   ...     enable_cell_expansion=True,
   ...     use_shared_styles=True
   ... )


.. py:function:: get_formatter() -> DataFrameHtmlFormatter

   Get the current global DataFrame HTML formatter.

   This function is used by the DataFrame._repr_html_ implementation to access
   the shared formatter instance. It can also be used directly when custom
   HTML rendering is needed.

   :returns: The global HTML formatter instance

   .. rubric:: Example

   >>> from datafusion.html_formatter import get_formatter
   >>> formatter = get_formatter()
   >>> formatter.max_cell_length = 50  # Increase cell length


.. py:function:: reset_formatter() -> None

   Reset the global DataFrame HTML formatter to default settings.

   This function creates a new formatter with default configuration
   and sets it as the global formatter for all DataFrames.

   .. rubric:: Example

   >>> from datafusion.html_formatter import reset_formatter
   >>> reset_formatter()  # Reset formatter to default settings


.. py:function:: set_formatter(formatter: DataFrameHtmlFormatter) -> None

   Set the global DataFrame HTML formatter.

   :param formatter: The formatter instance to use globally

   .. rubric:: Example

   >>> from datafusion.html_formatter import get_formatter, set_formatter
   >>> custom_formatter = DataFrameHtmlFormatter(max_cell_length=100)
   >>> set_formatter(custom_formatter)


